# bootstrapping
creating a playbook to set up the servers with a user and  provisioning ansible itself, leaving the rest of the tasks for another playbook

## creating bootstrap.yml
```
---

- hosts: all
  become: true
  pre_tasks:

  - name: install updates (Ubuntu)
    tags: always # this will always be executed
    apt:
      upgrade: dist
      update_cache: yes
    when: ansible_distribution == "Ubuntu"

  - name: install updates (Rocky)
    tags: always
    dnf:
      update_only: yes
      update_cache: yes
    when: ansible_distribution == "Rocky"

- hosts: all
  become: true
  tasks:

  - name: create jarvis user
    tags: always
    user: # using the user module
      name: jarvis # the new user name
      groups: root # user is part of this group

  - name: add ssh key for jarvis
    tags: always
    authorized_key: # module to add or remove ssh authorized keys for a user account
      user: jarvis
      key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBRsPEBBSXDFUrCKgcQQOqUUB8jWasasasasasasasasas ansible" # copy from ~/.ssh/ansible.pub

  - name: add sudoers file for jarvis
    tags: always
    copy:
      src: sudoer_jarvis
      dest: /etc/sudoers.d/jarvis
      owner: root
      group: root
      mode: 0440
```
```
anthony@ansible-control-host:~/ansible/scripts$ ansible-playbook --ask-become-pass bootstrap.yml
BECOME password: 

PLAY [all] ********************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.106]
ok: [10.0.0.121]
ok: [10.0.0.84]
ok: [10.0.0.213]
ok: [10.0.0.76]

TASK [install updates (Ubuntu)] ***********************************************************************************************************************
skipping: [10.0.0.213]
ok: [10.0.0.106]
ok: [10.0.0.84]
ok: [10.0.0.121]
ok: [10.0.0.76]

TASK [install updates (Rocky)] ************************************************************************************************************************
skipping: [10.0.0.121]
skipping: [10.0.0.106]
skipping: [10.0.0.84]
skipping: [10.0.0.76]
ok: [10.0.0.213]

PLAY [all] ********************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.121]
ok: [10.0.0.106]
ok: [10.0.0.84]
ok: [10.0.0.213]
ok: [10.0.0.76]

TASK [create jarvis user] *****************************************************************************************************************************
ok: [10.0.0.84]
ok: [10.0.0.106]
ok: [10.0.0.121]
ok: [10.0.0.213]
ok: [10.0.0.76]

TASK [add ssh key for jarvis] *************************************************************************************************************************
ok: [10.0.0.106]
ok: [10.0.0.121]
ok: [10.0.0.84]
ok: [10.0.0.213]
ok: [10.0.0.76]

TASK [add sudoers file for jarvis] ********************************************************************************************************************
ok: [10.0.0.106]
ok: [10.0.0.121]
ok: [10.0.0.84]
ok: [10.0.0.76]
ok: [10.0.0.213]

PLAY RECAP ********************************************************************************************************************************************
10.0.0.106                 : ok=6    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
10.0.0.121                 : ok=6    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
10.0.0.213                 : ok=6    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
10.0.0.76                  : ok=6    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
10.0.0.84                  : ok=6    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
```
```
anthony@ansible-control-host:~/ansible/scripts$ ansible-playbook site.yml

PLAY [all] ********************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.121]
ok: [10.0.0.84]
ok: [10.0.0.106]
ok: [10.0.0.213]
ok: [10.0.0.76]

TASK [install updates (Ubuntu)] ***********************************************************************************************************************
skipping: [10.0.0.213]
changed: [10.0.0.106]
changed: [10.0.0.121]
changed: [10.0.0.84]
changed: [10.0.0.76]

TASK [install updates (Rocky)] ************************************************************************************************************************
skipping: [10.0.0.121]
skipping: [10.0.0.106]
skipping: [10.0.0.84]
skipping: [10.0.0.76]
ok: [10.0.0.213]

PLAY [workstations] ***********************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.76]

TASK [install unzip] **********************************************************************************************************************************
ok: [10.0.0.76]

TASK [install terraform] ******************************************************************************************************************************
ok: [10.0.0.76]

PLAY [web_servers] ************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.121]
ok: [10.0.0.213]

TASK [install apache2 and php (Ubuntu)] ***************************************************************************************************************
skipping: [10.0.0.213]
ok: [10.0.0.121]

TASK [install apache (httpd) and php (Rocky)] *********************************************************************************************************
skipping: [10.0.0.121]
ok: [10.0.0.213]

TASK [start httpd (Rocky)] ****************************************************************************************************************************
skipping: [10.0.0.121]
ok: [10.0.0.213]

TASK [change email address for admin (Rocky)] *********************************************************************************************************
skipping: [10.0.0.121]
ok: [10.0.0.213]

TASK [restart httpd (Rocky)] **************************************************************************************************************************
skipping: [10.0.0.121]
skipping: [10.0.0.213]

TASK [copy default html file for site] ****************************************************************************************************************
ok: [10.0.0.121]
ok: [10.0.0.213]

PLAY [db_servers] *************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.106]

TASK [install mariadb (mariadb-server) (Ubuntu)] ******************************************************************************************************
ok: [10.0.0.106]

TASK [install mariadb (Rocky)] ************************************************************************************************************************
skipping: [10.0.0.106]

PLAY [file_servers] ***********************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************
ok: [10.0.0.84]

TASK [install samba  (Ubuntu or Rocky)] ***************************************************************************************************************
ok: [10.0.0.84]

PLAY RECAP ********************************************************************************************************************************************
10.0.0.106                 : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
10.0.0.121                 : ok=5    changed=1    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
10.0.0.213                 : ok=7    changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
10.0.0.76                  : ok=5    changed=1    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
10.0.0.84                  : ok=4    changed=1    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
```
